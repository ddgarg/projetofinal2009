<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1.0" />

<title>AJAX</title>
<link type='text/css' href='../stylesheets/todo.css' rel='stylesheet'>
<script src="http://code.jquery.com/jquery-2.0.0.js"></script>
<script src='../javascripts/todo.js' type='text/javascript'></script>
</head>
<body>

	<script type="text/javascript">

    function onChamarAjax() {
    	var parametros = {nome: "Caro Leitor"};
        var servico = "http://livro-capitulo07.herokuapp.com/hello";
        var $xhr = $.get(servico, parametros);
        $xhr.done(function(data) {
            alert(data);
        });
     }


    function onComErro() {
        var servico = "http://livro-capitulo07.herokuapp.com/error";
        $.get(servico).fail(function(data) {
   	         alert(data.responseText);
   	    });
    }


    var servico = "http://api.postmon.com.br/v1/cep/";
    var cep = "04101-300";
    
    function onCepDone(data) {
        console.log("A Casa do Código fica na " + data.logradouro);
    }
    
    $.getJSON(servico + cep).done(onCepDone);
    
    // Ação do botão buscar
    function onBuscarCep() {
        var cepDig = $('#inputCep').val().trim();

        console.log("CEP digitado: " + cepDig);
        
        if (cepDig !== "") {
             
             $.getJSON(servico + cepDig)
                 .done(function(data) {
                 $('#elComp').text(data.complemento);
                 $('#elBairro').text(data.bairro);
                 $('#elCidade').text(data.cidade);
                 $('#elLogr').text(data.logradouro);
                 $('#elCep').text(data.cep);
                 $('#elEst').text(data.estado);
                 
                 $('#tarefa-list').show('slow');
                 
                 $('#label').css("color","");
                 $('#inputCep').removeClass("errorInput");
                 
             }).fail(function(data) {
                 $('#label').css("color","red");
                 $('#inputCep').addClass("errorInput");
                 alert("CEP não encontrado.");
            });
        } else {
        	 $('#tarefa-list').hide('slow');
        }
        
    }
	
	$(function() {
		
		//onChamarAjax();
		
		$('#tarefa-list').hide();
		
		$('#botao').click(onChamarAjax);
		$('#botaoError').click(onComErro);
		
		$('#buttonSearchCep').click(onBuscarCep);
	});

</script>

	<br />

	<input type="button" value="Chamar" id="botao">

	<br />

	<input type="button" value="Chamar com Error" id="botaoError">

	<br />
	<br />
	
	<div class="todo">
	   <br />
	   <label id="label">CEP:</label>
	   <input type="text" id="inputCep" placeholder="Informar CEP" />
       <input type="button" id="buttonSearchCep" value="Buscar" />
	   
		<div id="tarefa-list">
	       <h2 id="tituloEnd">Endereço:</h2>
	       <div class="tarefa-item">
		       <div class="tarefa-texto"><strong>Complemento:&nbsp;&nbsp;</strong></div>
		       <div class="tarefa-texto" id="elComp"></div>
		       <div class="clear"></div>
		   </div>
	       <div class="tarefa-item">
		       <div class="tarefa-texto"><strong>Bairro:&nbsp;&nbsp;</strong></div>
		       <div class="tarefa-texto" id="elBairro"></div>
		       <div class="clear"></div>
		   </div>
	       <div class="tarefa-item">
		       <div class="tarefa-texto"><strong>Cidade:&nbsp;&nbsp;</strong></div>
		       <div class="tarefa-texto" id="elCidade"></div>
		       <div class="clear"></div>
		   </div>
	       <div class="tarefa-item">
		       <div class="tarefa-texto"><strong>Logradouro:&nbsp;&nbsp;</strong></div>
		       <div class="tarefa-texto" id="elLogr"></div>
		       <div class="clear"></div>
		   </div>
	       <div class="tarefa-item">
		       <div class="tarefa-texto"><strong>CEP:&nbsp;&nbsp;</strong></div>
		       <div class="tarefa-texto" id="elCep"></div>
		       <div class="clear"></div>
		   </div>
	       <div class="tarefa-item">
		       <div class="tarefa-texto"><strong>Estado:&nbsp;&nbsp;</strong></div>
		       <div class="tarefa-texto" id="elEst"></div>
		       <div class="clear"></div>
		   </div>
		</div>
	</div>
	<br />
	<br />
	<br />
	
	<br />
	<a href="../index.html">Voltar</a>

</body>
</html>